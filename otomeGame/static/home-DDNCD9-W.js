import{c as O,u as q,S as N,P as G,W as K,B as R,F as J,a as Q,b as X}from"./api-BG-G1cP5.js";import{_ as Y,r as f,w as Z,a as d,c as C,o as g,b as s,d as ee,F as $,e as A,n as te,t as P,f as l,L as ae,g as o,h as D,i as se,j as V,k as ne,l as oe,m as B,u as b,p as le,q as re}from"./index-C80g6NUL.js";const ie={class:"chat-container"},ce={class:"message-content"},ue={class:"message-time"},de={key:0,class:"message ai-message loading-indicator"},me={class:"message-bubble loading-bubble"},pe={class:"input-area"},ge={__name:"ChatDialog",props:{character:Object},setup(E){const k=E,a=f([]),p=f(""),r=f(null),v=f(!1),w=i=>`${i.getHours()}:${i.getMinutes().toString().padStart(2,"0")}`,M=async()=>{if(!p.value.trim())return;v.value=!0,a.value.push({content:p.value,isUser:!0,time:w(new Date)});const i=p.value;p.value="";try{const n=await O({character:k.character.name,message:i}),c={content:"",isUser:!1,time:w(new Date),isTyping:!0};a.value.push(c);let u=0;const h=setInterval(()=>{u<n.data.length?(c.content+=n.data.charAt(u),u++,a.value=[...a.value],V(()=>{r.value.scrollTop=r.value.scrollHeight})):(clearInterval(h),c.isTyping=!1)},50);V(()=>{r.value.scrollTop=r.value.scrollHeight}),v.value=!1}catch(n){console.error("聊天出错:",n),v.value=!1,a.value.push({content:"对话服务暂时不可用，请稍后再试",isUser:!1,time:w(new Date)})}};return Z(a,()=>{V(()=>{r.value.scrollTop=r.value.scrollHeight})},{deep:!0}),(i,n)=>{const c=ae,u=d("el-button"),h=d("el-input");return g(),C("div",ie,[s("div",{class:"message-area",ref_key:"messageContainer",ref:r},[(g(!0),C($,null,A(a.value,(_,x)=>(g(),C("div",{key:x,class:te(["message-bubble",{"user-message":_.isUser}])},[s("div",ce,P(_.content),1),s("div",ue,P(_.time),1)],2))),128)),v.value?(g(),C("div",de,[s("div",me,[l(c,{color:"#ffeef6"})])])):ee("",!0)],512),s("div",pe,[l(h,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=_=>p.value=_),placeholder:"输入消息...",onKeyup:se(M,["enter"]),class:"message-input"},{append:o(()=>[l(u,{type:"primary",onClick:M},{default:o(()=>n[1]||(n[1]=[D("发送")])),_:1})]),_:1},8,["modelValue"])])])}}},_e=Y(ge,[["__scopeId","data-v-082e765f"]]),ve=["onClick"],he={class:"character-info"},fe={class:"character-name"},we={class:"tags"},ye=["src"],ke={__name:"home",setup(E){const k=f(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),a=q(),p=le(),r=f(!1),v=e=>{e.currentTarget.classList.add("touch-active")},w=e=>{e.currentTarget.classList.remove("touch-active")},M=e=>{a.selectCharacter(e),k.value?p.push({path:"/chat-room",query:{character:e.name}}):r.value=!0};let i,n,c,u;ne(()=>{const e=()=>{k.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)};e(),window.addEventListener("resize",e),oe(()=>{window.removeEventListener("resize",e)}),x(),z()});const h=e=>a.currentPlaying===e.name,_=e=>{a.togglePlay({name:e.name,voiceSample:e.voiceSample})},x=()=>{n=new N,c=new G(75,window.innerWidth/window.innerHeight,.1,1e3),i=new K({alpha:!0}),i.setSize(window.innerWidth,window.innerHeight),document.querySelector("#bg").appendChild(i.domElement),window.addEventListener("resize",()=>{c.aspect=window.innerWidth/window.innerHeight,c.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)});const e=new R,t=[],S=3e3;for(let y=0;y<S;y++)t.push(Math.random()*2e3-1e3,Math.random()*2e3-1e3,Math.random()*2e3-1e3);e.setAttribute("position",new J(t,3));const T=new Q({size:4.5,color:15250662,transparent:!0,opacity:1});u=new X(e,T),n.add(u),c.position.z=1e3},z=()=>{requestAnimationFrame(z),u.rotation.x+=1e-4,u.rotation.y+=1e-4,i.render(n,c)};return(e,t)=>{const S=d("el-tag"),T=d("el-icon"),y=d("el-col"),L=d("el-row"),H=d("el-card"),I=d("el-container"),j=d("el-dialog"),F=d("el-main");return g(),B(F,{theme:b(a).theme},{default:o(()=>[t[6]||(t[6]=s("div",{id:"bg",class:"background"},null,-1)),l(I,{class:"pa-8"},{default:o(()=>[l(L,{justify:"center",style:{height:"100%"}},{default:o(()=>[l(y,{span:24,md:20,style:{display:"flex","align-items":"center","justify-content":"center"}},{default:o(()=>[l(H,{class:"glass-card rounded-xl pa-6"},{default:o(()=>[l(L,{class:"el-row--flex flex-nowrap justify-space-between",gutter:20},{default:o(()=>[(g(!0),C($,null,A(b(a).characters,(m,U)=>(g(),B(y,{key:U,span:6,class:"mb-8 px-2"},{default:o(()=>[s("div",{class:"character-card",onClick:W=>M(m),onTouchstartPassive:v,onTouchend:w},[s("div",he,[s("h3",fe,P(m.name),1),s("div",we,[l(S,{type:"info",effect:"dark",size:"large"},{default:o(()=>[D(P(m.personality),1)]),_:2},1024)])]),s("img",{src:m.image,style:{width:"100%","object-fit":"contain"}},null,8,ye),l(T,{class:"voice-icon",size:36,color:h(m)?"#FF4081":"#E91E63",onClick:W=>_(m)},{default:o(()=>[(g(),B(re(h(m)?"VideoPause":"VideoPlay")))]),_:2},1032,["color","onClick"])],40,ve)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(j,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=m=>r.value=m),title:b(a).selectedCharacter?b(a).selectedCharacter.name:"对话",width:"60%","custom-class":"chat-dialog","show-close":!1},{default:o(()=>[t[1]||(t[1]=s("div",{class:"sakura"},null,-1)),t[2]||(t[2]=s("div",{class:"sakura"},null,-1)),t[3]||(t[3]=s("div",{class:"sakura"},null,-1)),t[4]||(t[4]=s("div",{class:"sakura"},null,-1)),t[5]||(t[5]=s("div",{class:"sakura"},null,-1)),l(_e,{character:b(a).selectedCharacter},null,8,["character"])]),_:1},8,["modelValue","title"])]),_:1},8,["theme"])}}};export{ke as default};
